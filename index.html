<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Chat ‚Äì Custom Heuristic Engine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
body {
  background: linear-gradient(135deg, #1a1d2e, #2d3561);
  font-family: Arial, sans-serif;
  height: 100vh;
  margin: 0;
}
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
}
.chat-header {
  padding: 1rem;
  color: white;
  font-weight: bold;
  background: rgba(255,255,255,0.05);
}
.chat-messages {
  flex: 1;
  padding: 1rem;
  overflow-y: auto;
}
.message {
  max-width: 70%;
  margin-bottom: 1rem;
}
.sent {
  margin-left: auto;
}
.message-content {
  padding: 0.75rem 1rem;
  border-radius: 12px;
  color: white;
}
.sent .message-content {
  background: #667eea;
}
.received .message-content {
  background: #2d3561;
}
.security-alert {
  background: rgba(255,255,255,0.08);
  border-left: 4px solid red;
  padding: 0.75rem;
  color: white;
  margin-bottom: 1rem;
}
.security-alert.safe {
  border-left-color: #2ed573;
}
.chat-input {
  padding: 1rem;
  display: flex;
  gap: 0.5rem;
  background: rgba(255,255,255,0.05);
}
.chat-input input {
  flex: 1;
}
</style>
</head>

<body>

<div class="chat-container">
  <div class="chat-header">
    <i class="fa-solid fa-shield-halved"></i> Secure Chat (Custom Engine)
  </div>

  <div class="chat-messages" id="chatMessages"></div>

  <div class="chat-input">
    <input id="messageInput" class="form-control" placeholder="Type message or paste link">
    <input type="file" id="fileInput" class="form-control">
    <button class="btn btn-primary" id="sendBtn">Send</button>
  </div>
</div>

<script>
/* ============================
   CONFIG
============================ */

const MALICIOUS_KEYWORDS = [
  "free-money", "crypto", "wallet", "airdrop",
  "hack", "keygen", "crack", "stealer",
  "trojan", "virus", "malware",
  "login", "verify", "update-now", "secure-now"
];

let maliciousCsvEntries = [];

/* ============================
   LOAD CSV
============================ */

async function loadMaliciousCsv() {
  try {
    const res = await fetch("malicious_phish.csv");
    const text = await res.text();
    maliciousCsvEntries = text
      .split("\n")
      .map(l => l.trim().toLowerCase())
      .filter(Boolean);
  } catch (e) {
    console.warn("CSV not loaded");
  }
}
loadMaliciousCsv();

/* ============================
   DETECTION ENGINE
============================ */

function containsMaliciousKeyword(value) {
  return MALICIOUS_KEYWORDS.some(k =>
    value.toLowerCase().includes(k)
  );
}

function isInMaliciousCsv(value) {
  return maliciousCsvEntries.some(entry =>
    value.toLowerCase().includes(entry)
  );
}

function analyzeLink(url) {
  if (containsMaliciousKeyword(url))
    return { dangerous: true, reason: "Malicious keyword in URL" };

  if (isInMaliciousCsv(url))
    return { dangerous: true, reason: "URL found in malicious list" };

  return { dangerous: false };
}

function analyzeFile(file) {
  const name = file.name.toLowerCase();

  if (name.endsWith(".exe"))
    return { dangerous: true, reason: "Executable files are blocked" };

  if (containsMaliciousKeyword(name))
    return { dangerous: true, reason: "Malicious keyword in filename" };

  if (isInMaliciousCsv(name))
    return { dangerous: true, reason: "Filename found in malicious list" };

  return { dangerous: false };
}

/* ============================
   UI HELPERS
============================ */

const chatMessages = document.getElementById("chatMessages");

function addMessage(text, type) {
  const div = document.createElement("div");
  div.className = `message ${type}`;
  div.innerHTML = `<div class="message-content">${text}</div>`;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addSecurityAlert(text, safe = false) {
  const div = document.createElement("div");
  div.className = `security-alert ${safe ? "safe" : ""}`;
  div.innerHTML = `<strong>${safe ? "SAFE" : "DANGEROUS"}:</strong> ${text}`;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

/* ============================
   EVENTS
============================ */

document.getElementById("sendBtn").onclick = () => {
  const input = document.getElementById("messageInput");
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "sent");
  input.value = "";

  const urls = text.match(/https?:\/\/[^\s]+/g);
  if (urls) {
    for (const url of urls) {
      const result = analyzeLink(url);
      if (result.dangerous) {
        addSecurityAlert(`${url} ‚Üí ${result.reason}`);
        addMessage("‚ö†Ô∏è Link blocked", "received");
        return;
      }
    }
  }

  addMessage("Looks good üëç", "received");
};

document.getElementById("fileInput").onchange = (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const result = analyzeFile(file);
  addMessage(`Uploaded file: ${file.name}`, "sent");

  if (result.dangerous) {
    addSecurityAlert(`${file.name} ‚Üí ${result.reason}`);
    addMessage("üö´ File blocked", "received");
  } else {
    addSecurityAlert(`${file.name} is safe`, true);
    addMessage("File accepted üëç", "received");
  }

  e.target.value = "";
};
</script>

</body>
</html>
